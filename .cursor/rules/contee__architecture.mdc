---
description: Frontend Architecture Guidelines for React/Next.js PWA
globs: ["frontend/**/*", "src/**/*"]
alwaysApply: true
---

# Frontend Architecture - React/Next.js PWA

## 1. Executive Summary
- **Frontend Overview**: React/Next.js 기반의 PWA(Progressive Web App)로 구현되는 Contee 프론트엔드
- **Core Technologies**: React 18+, Next.js 14+, TypeScript, Tailwind CSS, Zustand, shadcn/ui
- **Key Objectives**:
  - 빠른 초기 로딩 (First Contentful Paint < 2초)
  - 오프라인 지원 및 PWA 기능
  - 반응형 디자인 (모바일/태블릿/데스크톱)
  - 접근성 지원 (WCAG 2.1 AA 준수)

## 2. Technology Stack

| Category | Technology | Version | Reasoning |
|----------|------------|---------|-----------|
| Framework | Next.js | 14+ | SSR/SSG 지원, 파일 기반 라우팅, 최적화된 번들링 |
| UI Library | React | 18+ | 컴포넌트 기반 아키텍처, Concurrent Features |
| Language | TypeScript | 5+ | 타입 안정성, 개발 생산성 향상 |
| Styling | Tailwind CSS | 3+ | 유틸리티 우선 CSS, 일관된 디자인 시스템 |
| State Management | Zustand | 4+ | 가벼운 상태 관리, TypeScript 지원 |
| UI Components | shadcn/ui | 1+ | Radix 기반, 접근성·일관성·테마 지원 |
| Primitives | Radix UI | 1+ | 접근성 보장, 포커스 관리/키보드 내비게이션 |
| Icons | lucide-react | 0.446+ | 일관된 아이콘 시스템, tree-shaking 우수 |
| Forms | React Hook Form | 7+ | 성능 최적화된 폼 관리 |
| HTTP Client | Axios | 1+ | 인터셉터, 에러 핸들링 지원 |

## 3. Project Structure

```
frontend/
├── src/
│   ├── app/                    # Next.js App Router
│   │   ├── (auth)/            # 인증 관련 페이지 그룹
│   │   │   ├── login/
│   │   │   └── register/
│   │   ├── (dashboard)/       # 대시보드 페이지 그룹
│   │   │   ├── contis/
│   │   │   │   ├── [id]/
│   │   │   │   └── create/
│   │   │   ├── songs/
│   │   │   └── settings/
│   │   ├── globals.css        # 전역 스타일
│   │   ├── layout.tsx         # 루트 레이아웃
│   │   └── page.tsx           # 홈페이지
│   ├── components/            # 재사용 가능한 컴포넌트
│   │   ├── ui/               # 기본 UI 컴포넌트
│   │   │   ├── button.tsx
│   │   │   ├── input.tsx
│   │   │   ├── label.tsx
│   │   │   ├── textarea.tsx
│   │   │   ├── form.tsx
│   │   │   ├── dialog.tsx
│   │   │   ├── dropdown-menu.tsx
│   │   │   ├── select.tsx
│   │   │   ├── sheet.tsx
│   │   │   ├── tooltip.tsx
│   │   │   └── index.ts
│   │   ├── features/         # 기능별 컴포넌트
│   │   │   ├── auth/
│   │   │   ├── conti/
│   │   │   ├── song/
│   │   │   └── user/
│   │   └── layout/           # 레이아웃 컴포넌트
│   │       ├── header.tsx
│   │       ├── sidebar.tsx
│   │       └── footer.tsx
│   ├── lib/                  # 유틸리티 및 설정
│   │   ├── api.ts           # API 클라이언트
│   │   ├── auth.ts          # 인증 관련 유틸리티
│   │   ├── utils.ts         # 공통 유틸리티
│   │   └── validations.ts   # 폼 검증 스키마
│   ├── hooks/               # 커스텀 훅
│   │   ├── use-auth.ts
│   │   ├── use-conti.ts
│   │   └── use-songs.ts
│   ├── stores/              # Zustand 스토어
│   │   ├── auth-store.ts
│   │   ├── conti-store.ts
│   │   └── ui-store.ts
│   ├── types/               # TypeScript 타입 정의
│   │   ├── auth.ts
│   │   ├── conti.ts
│   │   ├── song.ts
│   │   └── api.ts
│   └── constants/           # 상수 정의
│       ├── routes.ts
│       ├── api-endpoints.ts
│       └── ui-constants.ts
├── public/                  # 정적 파일
│   ├── icons/              # PWA 아이콘
│   ├── manifest.json       # PWA 매니페스트
│   └── sw.js              # Service Worker
├── next.config.js          # Next.js 설정
├── tailwind.config.js      # Tailwind CSS 설정
├── tsconfig.json          # TypeScript 설정
├── package.json           # 의존성 관리
└── components.json        # shadcn/ui 설정 (component registry)
```

## 4. Architecture Patterns

### 4.1 Component Architecture
- **Atomic Design**: Atoms → Molecules → Organisms → Templates → Pages
- **Container/Presentational Pattern**: 로직과 UI 분리
- **Compound Components**: 관련된 컴포넌트들을 그룹화
- **shadcn/ui Usage**: `@/components/ui/*`의 래핑 컴포넌트를 우선 사용 (Radix 직접 사용은 커스텀 필요 시에만)

#### 4.1.1 shadcn/ui 구성 원칙
- UI는 shadcn 제공 컴포넌트(예: `button`, `input`, `dialog`)를 기본으로 사용
- 디자인 토큰은 Tailwind config와 `components.json`에 정의된 프리셋 사용
- 아이콘은 `lucide-react`에서 필요한 것만 개별 임포트하여 tree-shaking 최적화

### 4.2 State Management Strategy
```typescript
// Zustand 스토어 예시
interface ContiStore {
  contis: Conti[];
  currentConti: Conti | null;
  isLoading: boolean;
  fetchContis: () => Promise<void>;
  createConti: (conti: CreateContiRequest) => Promise<void>;
  updateConti: (id: string, conti: UpdateContiRequest) => Promise<void>;
}
```

### 4.3 Data Fetching Patterns
- **Server Components**: 초기 데이터 로딩 (Next.js App Router)
- **Client Components**: 인터랙티브 데이터 페칭
- **React Query**: 서버 상태 관리 및 캐싱
- **Optimistic Updates**: 사용자 경험 향상

### 4.4 Error Handling Strategy
```typescript
// Error Boundary 컴포넌트
export class ErrorBoundary extends Component<Props, State> {
  // 에러 캐치 및 사용자 친화적 에러 메시지 표시
}

// API 에러 핸들링
export const apiClient = axios.create({
  baseURL: process.env.NEXT_PUBLIC_API_URL,
});

apiClient.interceptors.response.use(
  (response) => response,
  (error) => {
    // 에러 로깅 및 사용자 알림
    return Promise.reject(error);
  }
);
```

## 5. PWA Implementation

### 5.1 Service Worker
```javascript
// sw.js - 오프라인 지원 및 캐싱 전략
const CACHE_NAME = 'contee-v1';
const urlsToCache = [
  '/',
  '/static/js/bundle.js',
  '/static/css/main.css',
  '/manifest.json'
];

self.addEventListener('install', (event) => {
  event.waitUntil(
    caches.open(CACHE_NAME)
      .then((cache) => cache.addAll(urlsToCache))
  );
});
```

### 5.2 Web App Manifest
```json
{
  "name": "Contee - 찬양팀 콘티 관리",
  "short_name": "Contee",
  "description": "찬양팀 리더를 위한 콘티 작성 및 공유 서비스",
  "start_url": "/",
  "display": "standalone",
  "background_color": "#ffffff",
  "theme_color": "#3b82f6",
  "icons": [
    {
      "src": "/icons/icon-192x192.png",
      "sizes": "192x192",
      "type": "image/png"
    }
  ]
}
```

## 6. Performance Optimization

### 6.1 Code Splitting
- **Route-based Splitting**: Next.js 자동 코드 분할
- **Component-based Splitting**: React.lazy() 활용
- **Library Splitting**: 큰 라이브러리 별도 청크로 분리

### 6.2 Image Optimization
```typescript
import Image from 'next/image';

// Next.js Image 컴포넌트 활용
<Image
  src="/images/song-cover.jpg"
  alt="Song Cover"
  width={300}
  height={300}
  priority={isAboveFold}
  placeholder="blur"
  blurDataURL="data:image/jpeg;base64,..."
/>
```

### 6.3 Bundle Optimization
- **Tree Shaking**: 사용하지 않는 코드 제거
- **Dynamic Imports**: 필요시에만 모듈 로드
- **Bundle Analyzer**: 번들 크기 모니터링

### 6.4 Tailwind/shadcn 설정
- `components.json`를 소스 트루스로 관리 (컴포넌트 레지스트리)
- `tailwind.config.js`에 `tailwindcss-animate` 플러그인 포함 및 content 경로 정확히 지정
- `globals.css`에 shadcn CSS 변수와 다크 테마 루트 변수를 선언

## 7. Accessibility (a11y)

### 7.1 WCAG 2.1 AA 준수 (Radix 기반)
- **Keyboard Navigation**: 모든 기능 키보드로 접근 가능
- **Screen Reader Support**: 적절한 ARIA 레이블
- **Color Contrast**: 4.5:1 이상 대비율
- **Focus Management**: 명확한 포커스 표시
- **Radix Primitives**: `Dialog`, `Popover`, `Select` 등은 Radix 기반 shadcn 컴포넌트를 사용하여 기본 접근성 보장

### 7.2 Implementation Examples
```typescript
// 접근성 지원 컴포넌트
<button
  aria-label="콘티 저장"
  aria-describedby="save-help"
  disabled={isLoading}
>
  {isLoading ? '저장 중...' : '저장'}
</button>
<div id="save-help" className="sr-only">
  콘티를 저장합니다. 완료되면 알림을 받게 됩니다.
</div>
```

### 7.3 Dialog 예시 (shadcn/ui)
```tsx
import { Button } from '@/components/ui/button'
import { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger } from '@/components/ui/dialog'

export function ConfirmSaveDialog() {
  return (
    <Dialog>
      <DialogTrigger asChild>
        <Button variant="default">저장</Button>
      </DialogTrigger>
      <DialogContent>
        <DialogHeader>
          <DialogTitle>콘티를 저장할까요?</DialogTitle>
        </DialogHeader>
        <div className="flex justify-end gap-2">
          <Button variant="secondary">취소</Button>
          <Button variant="default">확인</Button>
        </div>
      </DialogContent>
    </Dialog>
  )
}
```

## 8. Testing Strategy

### 8.1 Testing Pyramid
- **Unit Tests**: Jest + React Testing Library
- **Integration Tests**: 컴포넌트 간 상호작용
- **E2E Tests**: Playwright 또는 Cypress

### 8.2 Testing Examples
```typescript
// 컴포넌트 테스트
import { render, screen, fireEvent } from '@testing-library/react';
import { ContiForm } from './ContiForm';

test('should create conti when form is submitted', async () => {
  render(<ContiForm />);
  
  fireEvent.change(screen.getByLabelText('예배명'), {
    target: { value: '주일예배' }
  });
  
  fireEvent.click(screen.getByRole('button', { name: '저장' }));
  
  await waitFor(() => {
    expect(screen.getByText('콘티가 저장되었습니다')).toBeInTheDocument();
  });
});
```

## 9. Development Workflow

### 9.1 Code Quality Tools
- **ESLint**: 코드 품질 검사
- **Prettier**: 코드 포맷팅
- **Husky**: Git 훅 설정
- **lint-staged**: 커밋 전 린트 검사

### 9.2 Build & Deployment
- **Development**: `npm run dev`
- **Production Build**: `npm run build`
- **Static Export**: `npm run export` (필요시)
- **Docker**: 컨테이너화 지원

### 9.3 shadcn/ui 세팅 가이드
- 설치
```bash
npm install clsx tailwind-merge lucide-react
npx shadcn@latest init -y
```
- 컴포넌트 추가 예시
```bash
npx shadcn@latest add button input label textarea form dialog dropdown-menu select sheet tooltip
```
- Tailwind 설정 예시
```ts
// tailwind.config.js
module.exports = {
  darkMode: ['class'],
  content: [
    './src/**/*.{ts,tsx}',
    './components/**/*.{ts,tsx}',
    './app/**/*.{ts,tsx}',
  ],
  plugins: [require('tailwindcss-animate')],
}
```
- 글로벌 스타일에 CSS 변수 선언
```css
/* src/app/globals.css */
@tailwind base;
@tailwind components;
@tailwind utilities;

:root { /* shadcn theme tokens (colors, radius 등) */ }
.dark { /* dark theme overrides */ }
```

### 9.4 컴포넌트 사용 규칙
- 내부 UI는 `@/components/ui/*`에서만 임포트
- Radix 직접 사용은 shadcn에 없는 고급 커스텀 컴포넌트일 때만
- 아이콘은 `import { Plus } from 'lucide-react'` 방식으로 개별 임포트

## 10. Security Considerations

### 10.1 Client-side Security
- **XSS Prevention**: 입력값 검증 및 이스케이핑
- **CSRF Protection**: SameSite 쿠키 설정
- **Content Security Policy**: CSP 헤더 설정
- **Environment Variables**: 민감한 정보 환경변수로 관리

### 10.2 Authentication Flow
```typescript
// JWT 토큰 관리
export const useAuth = () => {
  const [token, setToken] = useState<string | null>(null);
  
  const login = async (credentials: LoginCredentials) => {
    const response = await apiClient.post('/auth/login', credentials);
    const { token } = response.data;
    setToken(token);
    localStorage.setItem('auth_token', token);
  };
  
  const logout = () => {
    setToken(null);
    localStorage.removeItem('auth_token');
  };
  
  return { token, login, logout };
};
```