---
description: Frontend Code Guidelines for React/Next.js Development
globs: ["frontend/**/*", "src/**/*"]
alwaysApply: true
---

# Frontend Code Guidelines - React/Next.js

## 1. Project Overview

Contee 프론트엔드는 React 18+와 Next.js 14+를 기반으로 한 PWA(Progressive Web App)입니다. TypeScript를 사용하여 타입 안정성을 보장하고, Tailwind CSS로 일관된 디자인 시스템을 구현합니다. Zustand를 통한 상태 관리와 React Hook Form을 통한 폼 관리를 통해 사용자 경험을 최적화합니다.

## 2. Core Principles

- **Component-First**: 재사용 가능한 컴포넌트 중심의 개발
- **Type Safety**: TypeScript를 통한 컴파일 타임 에러 방지
- **Performance**: 최적화된 렌더링과 번들 크기 관리
- **Accessibility**: WCAG 2.1 AA 준수를 통한 접근성 보장
- **User Experience**: 직관적이고 반응성 있는 UI/UX

## 3. React Component Guidelines

### 3.1 Component Structure

```typescript
// ✅ GOOD: 함수형 컴포넌트 with TypeScript
interface ContiCardProps {
  conti: Conti;
  onEdit: (id: string) => void;
  onDelete: (id: string) => void;
}

export const ContiCard: React.FC<ContiCardProps> = ({ 
  conti, 
  onEdit, 
  onDelete 
}) => {
  return (
    <div className="bg-white rounded-lg shadow-md p-6">
      <h3 className="text-lg font-semibold">{conti.title}</h3>
      <p className="text-gray-600">{conti.date}</p>
      <div className="mt-4 flex gap-2">
        <Button onClick={() => onEdit(conti.id)}>편집</Button>
        <Button variant="destructive" onClick={() => onDelete(conti.id)}>
          삭제
        </Button>
      </div>
    </div>
  );
};

// ❌ BAD: 클래스형 컴포넌트 (레거시)
class ContiCard extends React.Component {
  // ...
}
```

### 3.2 Component Naming Conventions

```typescript
// ✅ GOOD: PascalCase for components
export const ContiForm = () => { /* ... */ };
export const SongSearch = () => { /* ... */ };
export const UserProfile = () => { /* ... */ };

// ✅ GOOD: kebab-case for files
// conti-form.tsx
// song-search.tsx
// user-profile.tsx

// ❌ BAD: camelCase for components
export const contiForm = () => { /* ... */ };

// ❌ BAD: PascalCase for files
// ContiForm.tsx
```

### 3.3 Props and State Management

```typescript
// ✅ GOOD: Interface for props
interface ContiFormProps {
  initialData?: Partial<Conti>;
  onSubmit: (data: CreateContiRequest) => Promise<void>;
  isLoading?: boolean;
}

// ✅ GOOD: Default props with destructuring
export const ContiForm: React.FC<ContiFormProps> = ({
  initialData = {},
  onSubmit,
  isLoading = false
}) => {
  // ...
};

// ✅ GOOD: Local state with useState
const [isOpen, setIsOpen] = useState(false);
const [formData, setFormData] = useState<CreateContiRequest>({
  title: '',
  date: new Date().toISOString().split('T')[0],
  notes: ''
});

// ❌ BAD: Any type
const [data, setData] = useState<any>({});
```

### 3.4 Custom Hooks

```typescript
// ✅ GOOD: Custom hook for API calls
export const useContis = () => {
  const [contis, setContis] = useState<Conti[]>([]);
  const [isLoading, setIsLoading] = useState(false);
  const [error, setError] = useState<string | null>(null);

  const fetchContis = useCallback(async () => {
    setIsLoading(true);
    setError(null);
    
    try {
      const response = await apiClient.get<Conti[]>('/api/contis');
      setContis(response.data);
    } catch (err) {
      setError(err instanceof Error ? err.message : 'Unknown error');
    } finally {
      setIsLoading(false);
    }
  }, []);

  useEffect(() => {
    fetchContis();
  }, [fetchContis]);

  return { contis, isLoading, error, refetch: fetchContis };
};

// ✅ GOOD: Custom hook for form management
export const useContiForm = (initialData?: Partial<Conti>) => {
  const { register, handleSubmit, formState: { errors }, reset } = useForm<CreateContiRequest>({
    defaultValues: initialData
  });

  const onSubmit = async (data: CreateContiRequest) => {
    try {
      await contiService.createConti(data);
      reset();
      toast.success('콘티가 성공적으로 생성되었습니다.');
    } catch (error) {
      toast.error('콘티 생성에 실패했습니다.');
    }
  };

  return {
    register,
    handleSubmit: handleSubmit(onSubmit),
    errors,
    reset
  };
};
```

## 4. Next.js Specific Guidelines

### 4.1 App Router Structure

```typescript
// ✅ GOOD: App Router page structure
// app/(dashboard)/contis/page.tsx
export default async function ContisPage() {
  const contis = await contiService.getContis();
  
  return (
    <div className="container mx-auto px-4 py-8">
      <h1 className="text-2xl font-bold mb-6">콘티 목록</h1>
      <ContiList contis={contis} />
    </div>
  );
}

// ✅ GOOD: Dynamic routes
// app/(dashboard)/contis/[id]/page.tsx
interface ContiDetailPageProps {
  params: { id: string };
}

export default async function ContiDetailPage({ params }: ContiDetailPageProps) {
  const conti = await contiService.getConti(params.id);
  
  if (!conti) {
    notFound();
  }
  
  return <ContiDetail conti={conti} />;
}
```

### 4.2 Server vs Client Components

```typescript
// ✅ GOOD: Server Component (기본값)
// app/contis/page.tsx
export default async function ContisPage() {
  // 서버에서 데이터 페칭
  const contis = await contiService.getContis();
  
  return (
    <div>
      <ContiList contis={contis} />
      <ContiForm /> {/* Client Component */}
    </div>
  );
}

// ✅ GOOD: Client Component (인터랙션 필요시)
'use client';

import { useState } from 'react';

export const ContiForm = () => {
  const [isSubmitting, setIsSubmitting] = useState(false);
  
  const handleSubmit = async (data: CreateContiRequest) => {
    setIsSubmitting(true);
    // ...
  };
  
  return (
    <form onSubmit={handleSubmit}>
      {/* 폼 내용 */}
    </form>
  );
};
```

### 4.3 API Routes

```typescript
// ✅ GOOD: API route structure
// app/api/contis/route.ts
import { NextRequest, NextResponse } from 'next/server';

export async function GET(request: NextRequest) {
  try {
    const contis = await contiService.getContis();
    return NextResponse.json(contis);
  } catch (error) {
    return NextResponse.json(
      { error: 'Failed to fetch contis' },
      { status: 500 }
    );
  }
}

export async function POST(request: NextRequest) {
  try {
    const body = await request.json();
    const conti = await contiService.createConti(body);
    return NextResponse.json(conti, { status: 201 });
  } catch (error) {
    return NextResponse.json(
      { error: 'Failed to create conti' },
      { status: 400 }
    );
  }
}
```

## 5. State Management with Zustand

### 5.1 Store Structure

```typescript
// ✅ GOOD: Zustand store with TypeScript
interface ContiStore {
  contis: Conti[];
  currentConti: Conti | null;
  isLoading: boolean;
  error: string | null;
  
  // Actions
  fetchContis: () => Promise<void>;
  createConti: (conti: CreateContiRequest) => Promise<void>;
  updateConti: (id: string, conti: UpdateContiRequest) => Promise<void>;
  deleteConti: (id: string) => Promise<void>;
  setCurrentConti: (conti: Conti | null) => void;
  clearError: () => void;
}

export const useContiStore = create<ContiStore>((set, get) => ({
  contis: [],
  currentConti: null,
  isLoading: false,
  error: null,

  fetchContis: async () => {
    set({ isLoading: true, error: null });
    try {
      const contis = await contiService.getContis();
      set({ contis, isLoading: false });
    } catch (error) {
      set({ 
        error: error instanceof Error ? error.message : 'Unknown error',
        isLoading: false 
      });
    }
  },

  createConti: async (contiData) => {
    set({ isLoading: true, error: null });
    try {
      const newConti = await contiService.createConti(contiData);
      set(state => ({ 
        contis: [...state.contis, newConti],
        isLoading: false 
      }));
    } catch (error) {
      set({ 
        error: error instanceof Error ? error.message : 'Unknown error',
        isLoading: false 
      });
    }
  },

  // ... other actions
}));
```

### 5.2 Store Usage in Components

```typescript
// ✅ GOOD: Using store in components
export const ContiList = () => {
  const { contis, isLoading, error, fetchContis } = useContiStore();
  
  useEffect(() => {
    fetchContis();
  }, [fetchContis]);
  
  if (isLoading) return <LoadingSpinner />;
  if (error) return <ErrorMessage message={error} />;
  
  return (
    <div className="grid gap-4">
      {contis.map(conti => (
        <ContiCard key={conti.id} conti={conti} />
      ))}
    </div>
  );
};
```

## 6. Styling with Tailwind CSS

### 6.1 Utility-First Approach

```typescript
// ✅ GOOD: Tailwind utility classes
export const Button: React.FC<ButtonProps> = ({ 
  variant = 'primary', 
  size = 'md', 
  children, 
  ...props 
}) => {
  const baseClasses = 'font-medium rounded-lg transition-colors focus:outline-none focus:ring-2';
  
  const variantClasses = {
    primary: 'bg-blue-600 text-white hover:bg-blue-700 focus:ring-blue-500',
    secondary: 'bg-gray-200 text-gray-900 hover:bg-gray-300 focus:ring-gray-500',
    destructive: 'bg-red-600 text-white hover:bg-red-700 focus:ring-red-500'
  };
  
  const sizeClasses = {
    sm: 'px-3 py-1.5 text-sm',
    md: 'px-4 py-2 text-base',
    lg: 'px-6 py-3 text-lg'
  };
  
  return (
    <button
      className={`${baseClasses} ${variantClasses[variant]} ${sizeClasses[size]}`}
      {...props}
    >
      {children}
    </button>
  );
};
```

### 6.2 Responsive Design

```typescript
// ✅ GOOD: Responsive design with Tailwind
export const ContiGrid = () => {
  return (
    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
      {contis.map(conti => (
        <ContiCard key={conti.id} conti={conti} />
      ))}
    </div>
  );
};

// ✅ GOOD: Mobile-first approach
export const Navigation = () => {
  return (
    <nav className="flex flex-col md:flex-row items-center justify-between p-4">
      <div className="mb-4 md:mb-0">
        <Logo />
      </div>
      <div className="flex space-x-4">
        <NavLink href="/contis">콘티</NavLink>
        <NavLink href="/songs">곡</NavLink>
      </div>
    </nav>
  );
};
```

## 7. Form Handling with React Hook Form

### 7.1 Form Structure

```typescript
// ✅ GOOD: Form with validation
export const ContiForm: React.FC<ContiFormProps> = ({ onSubmit, initialData }) => {
  const {
    register,
    handleSubmit,
    formState: { errors, isSubmitting },
    reset
  } = useForm<CreateContiRequest>({
    defaultValues: initialData,
    resolver: zodResolver(createContiSchema)
  });

  const onFormSubmit = async (data: CreateContiRequest) => {
    try {
      await onSubmit(data);
      reset();
      toast.success('콘티가 성공적으로 저장되었습니다.');
    } catch (error) {
      toast.error('저장에 실패했습니다.');
    }
  };

  return (
    <form onSubmit={handleSubmit(onFormSubmit)} className="space-y-6">
      <div>
        <label htmlFor="title" className="block text-sm font-medium text-gray-700">
          예배명
        </label>
        <input
          {...register('title')}
          type="text"
          className="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500"
        />
        {errors.title && (
          <p className="mt-1 text-sm text-red-600">{errors.title.message}</p>
        )}
      </div>
      
      <Button type="submit" disabled={isSubmitting}>
        {isSubmitting ? '저장 중...' : '저장'}
      </Button>
    </form>
  );
};
```

### 7.2 Validation Schema

```typescript
// ✅ GOOD: Zod validation schema
import { z } from 'zod';

export const createContiSchema = z.object({
  title: z.string().min(1, '예배명을 입력해주세요').max(100, '예배명은 100자 이하로 입력해주세요'),
  date: z.string().min(1, '날짜를 선택해주세요'),
  notes: z.string().optional(),
  songs: z.array(z.object({
    songId: z.string(),
    order: z.number().min(1)
  })).min(1, '최소 하나의 곡을 선택해주세요')
});

export type CreateContiRequest = z.infer<typeof createContiSchema>;
```

## 8. Error Handling

### 8.1 Error Boundaries

```typescript
// ✅ GOOD: Error Boundary component
interface ErrorBoundaryState {
  hasError: boolean;
  error?: Error;
}

export class ErrorBoundary extends React.Component<
  React.PropsWithChildren<{}>,
  ErrorBoundaryState
> {
  constructor(props: React.PropsWithChildren<{}>) {
    super(props);
    this.state = { hasError: false };
  }

  static getDerivedStateFromError(error: Error): ErrorBoundaryState {
    return { hasError: true, error };
  }

  componentDidCatch(error: Error, errorInfo: React.ErrorInfo) {
    console.error('Error caught by boundary:', error, errorInfo);
    // 에러 로깅 서비스에 전송
  }

  render() {
    if (this.state.hasError) {
      return (
        <div className="min-h-screen flex items-center justify-center">
          <div className="text-center">
            <h2 className="text-2xl font-bold text-gray-900 mb-4">
              문제가 발생했습니다
            </h2>
            <p className="text-gray-600 mb-4">
              페이지를 새로고침하거나 잠시 후 다시 시도해주세요.
            </p>
            <Button onClick={() => window.location.reload()}>
              새로고침
            </Button>
          </div>
        </div>
      );
    }

    return this.props.children;
  }
}
```

### 8.2 API Error Handling

```typescript
// ✅ GOOD: API client with error handling
export const apiClient = axios.create({
  baseURL: process.env.NEXT_PUBLIC_API_URL,
  timeout: 10000
});

apiClient.interceptors.response.use(
  (response) => response,
  (error) => {
    if (error.response?.status === 401) {
      // 인증 에러 처리
      useAuthStore.getState().logout();
      window.location.href = '/login';
    } else if (error.response?.status >= 500) {
      // 서버 에러 처리
      toast.error('서버 오류가 발생했습니다. 잠시 후 다시 시도해주세요.');
    }
    
    return Promise.reject(error);
  }
);
```

## 9. Performance Optimization

### 9.1 Code Splitting

```typescript
// ✅ GOOD: Dynamic imports for code splitting
const ContiEditor = dynamic(() => import('./ContiEditor'), {
  loading: () => <LoadingSpinner />,
  ssr: false
});

const SongSearch = dynamic(() => import('./SongSearch'), {
  loading: () => <div>검색 로딩 중...</div>
});

// ✅ GOOD: Route-based code splitting
const ContiDetailPage = dynamic(() => import('./ContiDetailPage'));
```

### 9.2 Memoization

```typescript
// ✅ GOOD: React.memo for expensive components
export const ContiCard = React.memo<ContiCardProps>(({ conti, onEdit, onDelete }) => {
  return (
    <div className="bg-white rounded-lg shadow-md p-6">
      <h3 className="text-lg font-semibold">{conti.title}</h3>
      {/* ... */}
    </div>
  );
});

// ✅ GOOD: useMemo for expensive calculations
export const ContiStats = ({ contis }: { contis: Conti[] }) => {
  const stats = useMemo(() => {
    return {
      total: contis.length,
      thisMonth: contis.filter(c => isThisMonth(c.createdAt)).length,
      averageSongs: contis.reduce((acc, c) => acc + c.songs.length, 0) / contis.length
    };
  }, [contis]);

  return (
    <div className="grid grid-cols-3 gap-4">
      <StatCard title="전체 콘티" value={stats.total} />
      <StatCard title="이번 달" value={stats.thisMonth} />
      <StatCard title="평균 곡 수" value={Math.round(stats.averageSongs)} />
    </div>
  );
};

// ✅ GOOD: useCallback for event handlers
export const ContiList = () => {
  const { contis, deleteConti } = useContiStore();
  
  const handleDelete = useCallback(async (id: string) => {
    if (confirm('정말 삭제하시겠습니까?')) {
      await deleteConti(id);
    }
  }, [deleteConti]);

  return (
    <div>
      {contis.map(conti => (
        <ContiCard 
          key={conti.id} 
          conti={conti} 
          onDelete={handleDelete}
        />
      ))}
    </div>
  );
};
```

## 10. Testing Guidelines

### 10.1 Component Testing

```typescript
// ✅ GOOD: Component test with React Testing Library
import { render, screen, fireEvent, waitFor } from '@testing-library/react';
import { ContiForm } from './ContiForm';

describe('ContiForm', () => {
  it('should submit form with valid data', async () => {
    const mockSubmit = jest.fn();
    render(<ContiForm onSubmit={mockSubmit} />);

    fireEvent.change(screen.getByLabelText('예배명'), {
      target: { value: '주일예배' }
    });
    fireEvent.change(screen.getByLabelText('날짜'), {
      target: { value: '2024-01-15' }
    });

    fireEvent.click(screen.getByRole('button', { name: '저장' }));

    await waitFor(() => {
      expect(mockSubmit).toHaveBeenCalledWith({
        title: '주일예배',
        date: '2024-01-15',
        notes: '',
        songs: []
      });
    });
  });

  it('should show validation errors for invalid data', async () => {
    render(<ContiForm onSubmit={jest.fn()} />);

    fireEvent.click(screen.getByRole('button', { name: '저장' }));

    await waitFor(() => {
      expect(screen.getByText('예배명을 입력해주세요')).toBeInTheDocument();
    });
  });
});
```

### 10.2 Hook Testing

```typescript
// ✅ GOOD: Custom hook test
import { renderHook, act } from '@testing-library/react';
import { useContis } from './useContis';

describe('useContis', () => {
  it('should fetch contis on mount', async () => {
    const { result } = renderHook(() => useContis());

    expect(result.current.isLoading).toBe(true);

    await act(async () => {
      await new Promise(resolve => setTimeout(resolve, 0));
    });

    expect(result.current.isLoading).toBe(false);
    expect(result.current.contis).toHaveLength(2);
  });
});
```

## 11. Accessibility Guidelines

### 11.1 ARIA Labels and Roles

```typescript
// ✅ GOOD: Accessible form
export const ContiForm = () => {
  return (
    <form role="form" aria-labelledby="form-title">
      <h2 id="form-title">새 콘티 만들기</h2>
      
      <div>
        <label htmlFor="title" className="block text-sm font-medium">
          예배명
        </label>
        <input
          id="title"
          type="text"
          aria-describedby="title-help"
          aria-required="true"
          className="mt-1 block w-full rounded-md border-gray-300"
        />
        <p id="title-help" className="mt-1 text-sm text-gray-500">
          예배의 제목을 입력해주세요
        </p>
      </div>
      
      <button
        type="submit"
        aria-describedby="submit-help"
        className="bg-blue-600 text-white px-4 py-2 rounded"
      >
        저장
      </button>
      <p id="submit-help" className="sr-only">
        콘티를 저장합니다
      </p>
    </form>
  );
};
```

### 11.2 Keyboard Navigation

```typescript
// ✅ GOOD: Keyboard accessible component
export const ContiCard = ({ conti, onEdit, onDelete }: ContiCardProps) => {
  const handleKeyDown = (event: React.KeyboardEvent) => {
    if (event.key === 'Enter' || event.key === ' ') {
      event.preventDefault();
      onEdit(conti.id);
    }
  };

  return (
    <div
      role="button"
      tabIndex={0}
      onKeyDown={handleKeyDown}
      onClick={() => onEdit(conti.id)}
      className="bg-white rounded-lg shadow-md p-6 cursor-pointer focus:outline-none focus:ring-2 focus:ring-blue-500"
    >
      <h3 className="text-lg font-semibold">{conti.title}</h3>
      <p className="text-gray-600">{conti.date}</p>
    </div>
  );
};
```

## 12. Code Quality Rules

### 12.1 MUST Follow

- **TypeScript Strict Mode**: 모든 코드는 TypeScript strict mode에서 컴파일되어야 함
- **Component Props Interface**: 모든 컴포넌트는 명시적인 props interface를 가져야 함
- **Error Boundaries**: 모든 페이지는 Error Boundary로 감싸져야 함
- **Loading States**: 모든 비동기 작업은 로딩 상태를 표시해야 함
- **Accessibility**: 모든 인터랙티브 요소는 접근성 기준을 만족해야 함

### 12.2 MUST NOT Do

- **Any Type**: `any` 타입 사용 금지
- **Inline Styles**: 인라인 스타일 대신 Tailwind 클래스 사용
- **Direct DOM Manipulation**: React의 가상 DOM 사용
- **Console.log in Production**: 프로덕션 코드에서 console.log 사용 금지
- **Missing Error Handling**: 에러 처리가 없는 비동기 작업 금지

## 13. File Organization

### 13.1 Import Order

```typescript
// ✅ GOOD: Import order
// 1. React and Next.js imports
import React, { useState, useEffect, useCallback } from 'react';
import { useRouter } from 'next/navigation';
import Link from 'next/link';

// 2. Third-party libraries
import { useForm } from 'react-hook-form';
import { toast } from 'react-hot-toast';

// 3. Internal imports (absolute paths)
import { Button } from '@/components/ui/button';
import { useContiStore } from '@/stores/conti-store';
import { ContiService } from '@/services/conti-service';

// 4. Relative imports
import { ContiCard } from './conti-card';
import { ContiForm } from './conti-form';

// 5. Type imports
import type { Conti, CreateContiRequest } from '@/types/conti';
```

### 13.2 Export Patterns

```typescript
// ✅ GOOD: Named exports for components
export const ContiCard = () => { /* ... */ };
export const ContiForm = () => { /* ... */ };
export const ContiList = () => { /* ... */ };

// ✅ GOOD: Default export for pages
export default function ContisPage() {
  return <div>/* ... */</div>;
}

// ✅ GOOD: Barrel exports
// components/conti/index.ts
export { ContiCard } from './conti-card';
export { ContiForm } from './conti-form';
export { ContiList } from './conti-list';
```